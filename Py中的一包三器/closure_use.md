[toc]

# 闭包的原理和使用

## 概念：

> 在函数内部在定义一个函数，并这个函数用到了外面函数的变量，那么这个函数以及用到的一些变量，称之为闭包；里面函数的代码加上外面函数的变量，这个独立的空间称这为闭包；函数里面嵌套另外一个函数，当调用外面的函数时，里面的函数都要被执行一遍；

## 概念细述：

> 外层参数来自与函数名一致的调用（实参），可同时传递闭包外的函数的引用和其它参数多个参数（形参）  
内层参数来自外层函数调用对象的调用（实参），同时传递给闭包外的对应函数以及它的调用（形参）  
通过外层传递的只初始化一次，通过内层传递的初始化次数与调用次数一致。就跟变量在while true外面和里面一样

## 创建闭包的必须满足的条件：
==必须有一个内嵌函数；内嵌函数必须引用外部函数的变量；外部函数的返回值必须是内嵌函数；==
```
语法格式：
def line(k, b):
    # all_num = 0  # 来记录执行的次数
    all_num = [0]
    
    def create_y(x):
        # nonlocal all_num  # python3的方式
        all_num[0] += 1  # python2的方式
        print("这是第%d次执行,当x=%d时，y=%d" % (all_num[0] , x, k*x+b))
    return create_y
    
line_1 = line(1, 2)  # 创建一个新的闭包，让line_1指向
# print(id(line_6_1))
line_1(0)
line_1(1)
```
## 闭包的优缺点：
### 优点：
> 可以提高代码的复用性

### 缺点：
> 由于闭包引用了外部函数的局部变量，外部函数的局部变量没有及时释放，消耗内存。

### 特点：
> 闭包类似于实例对象一样，是一个独立空间，多个闭包就是多个各自独立的空间，互不影响；闭包占用的内存空间要远小于一个实例对象的空间，因此在需要一个独立空间（需要变量+功能）时，除了考虑实例对象之外，还可以考虑闭包


## 函数，匿名函数，闭包，对象 当做实参时的区别：
```
def xxxx(temp):
    passs
xxxx(函数名)
xxxx(匿名函数名)
xxxx(闭包)
xxxx(实例对象)
匿名函数能够完成基本的简单功能，，，传递是这个函数的引用 只有功能
普通函数能够完成较为复杂的功能，，，传递是这个函数的引用 只有功能
闭包能够完成较为复杂的功能，，，传递是这个闭包中的函数以及数据，因此传递是功能+数据
对象能够完成最为复杂的功能，，，传递是很多数据+很多功能，因此传递是功能+数据
```

## 修改闭包外部函数中的变量：

* python3中的方法：**在内部函数中加 nonlocal +变量名**

## 闭包与函数的区别
> 格式上：闭包是两层函数的嵌套

> 作用：闭包的外层一定要有参数，传递给内层使用（否则闭包就没存在的意义，还不如用一层函数）,外层函数返回内层函数的引用。
闭包：简化函数，多次使用的抽取成外层函数的参数。

---

